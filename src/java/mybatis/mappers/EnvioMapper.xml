<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="envio">

    <select id="obtenerEnvio" resultType="pojo.Envio">
    SELECT e.IdEnvio, e.Costo, e.IdOrigen, e.IdDestino, e.IdPaquete, e.IdCliente, se.Status, e.NumeroGuia AS 'NoGuia',
        CONCAT(dc.Calle, ' ', dc.Numero, ' ', dc.Colonia, ' ', dc.CodigoPostal) AS Cliente,
        CONCAT(do.Calle, ' ', do.Numero, ' ', do.Colonia, ' ', do.CodigoPostal, ' ', do.Ciudad, ' ', do.Estado) AS Origen,
        CONCAT(dd.Calle, ' ', dd.Numero, ' ', dd.Colonia, ' ', dd.CodigoPostal, ' ', dd.Ciudad, ' ', dd.Estado) AS Destino
    FROM Envio e
    INNER JOIN Cliente c ON c.IdCliente = e.IdCliente
    INNER JOIN statusenvio se ON se.IdEnvio = E.IdEnvio
    INNER JOIN DireccionCliente dc ON dc.IdDireccion = c.IdDireccion
    INNER JOIN DireccionOrigen do ON do.IdOrigen = e.IdOrigen
    INNER JOIN DireccionDestino dd ON dd.IdDestino = e.IdDestino;
   </select>

   <select id="obtenerEnvioNoGuia" resultType="pojo.Envio">
    SELECT e.IdEnvio, e.Costo, e.IdOrigen, e.IdDestino, e.IdPaquete, e.IdCliente, se.Status, e.NumeroGuia AS 'NoGuia',
        CONCAT(dc.Calle, ' ', dc.Numero, ' ', dc.Colonia, ' ', dc.CodigoPostal) AS Cliente,
        CONCAT(do.Calle, ' ', do.Numero, ' ', do.Colonia, ' ', do.CodigoPostal, ' ', do.Ciudad, ' ', do.Estado) AS Origen,
        CONCAT(dd.Calle, ' ', dd.Numero, ' ', dd.Colonia, ' ', dd.CodigoPostal, ' ', dd.Ciudad, ' ', dd.Estado) AS Destino
    FROM Envio e
    INNER JOIN Cliente c ON c.IdCliente = e.IdCliente
    INNER JOIN statusenvio se ON se.IdEnvio = E.IdEnvio
    INNER JOIN DireccionCliente dc ON dc.IdDireccion = c.IdDireccion
    INNER JOIN DireccionOrigen do ON do.IdOrigen = e.IdOrigen
    INNER JOIN DireccionDestino dd ON dd.IdDestino = e.IdDestino
    WHERE e.NumeroGuia = #{NumeroGuia};
   </select>

<select id="obtenerEnvioNoLicencia" resultType="pojo.Envio">
    SELECT e.NumeroGuia, s.Status,
           CONCAT(c2.nombre, ' ', c2.apellidoMaterno, ' ', c2.apellidoPaterno) AS `Repartidor`,
           CONCAT(d2.Calle, ' ', d2.Numero, ' ', d2.Colonia, ' ', d2.CodigoPostal, ' ', d2.Estado, ' ', d2.Ciudad) AS `Destino`
    FROM envio e
    INNER JOIN direcciondestino d2 ON d2.IdDestino = e.IdDestino
    INNER JOIN asociacionenvio a ON a.IdEnvio = e.IdEnvio
    INNER JOIN statusenvio s ON s.IdEnvio = e.IdEnvio
    INNER JOIN conductor c ON c.IdConductor = a.IdConductor
    INNER JOIN colaborador c2 ON c2.IdColaborador = c.IdConductor
    WHERE c.NumeroLicencia = #{NumeroLicencia};
</select>

     
    <select id="obtenerEstatus" resultType="pojo.Envio">
    SELECT se.idStatus, se.IdEnvio, se.Status
    FROM StatusEnvio se
    WHERE se.IdEnvio = #{IdEnvio};
    </select>

    <insert id="cambiarStatus" parameterType="map"> 
      INSERT INTO statusenvio (IdEnvio, Status)
      VALUES (#{IdEnvio},#{Status});
   </insert>
        
    <insert id="registrarEnvio" parameterType="pojo.Envio" >
     INSERT INTO Envio (Costo, IdOrigen, IdDestino, IdPaquete, IdCliente, Status)
     VALUES (#{Costo}, #{IdOrigen}, #{IdDestino}, #{IdPaquete}, #{IdCliente}, #{Status});
    </insert>

    <update id="editarEnvio" parameterType="pojo.Envio">
    UPDATE Envio
    SET  Costo = #{Costo}, IdOrigen = #{IdOrigen}, IdDestino = #{IdDestino},IdPaquete = #{IdPaquete},IdCliente = #{IdCliente},Status = #{Status}
    WHERE IdEnvio = #{IdEnvio};
    </update>
    
    <delete id="eliminarEnvioId" parameterType="pojo.Envio">
        DELETE
        FROM Envio
        WHERE IdEnvio = #{IdEnvio}
    </delete>

</mapper>