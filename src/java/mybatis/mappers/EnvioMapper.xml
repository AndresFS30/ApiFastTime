<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="envio">

    <select id="obtenerEnvio" resultType="pojo.Envio">
    CALL ObtenerEnvios();
   </select>

   <select id="obtenerEnvioNoGuia" resultType="pojo.Envio">
    SELECT e.idEnvio, e.costo, e.idOrigen, e.idDestino, e.idPaquete, e.idCliente, e.status, e.numeroGuia AS 'noGuia',
        CONCAT(dc.calle, ' ', dc.numero, ' ', dc.colonia, ' ', dc.codigoPostal, ' ', dc.ciudad, ' ', dc.estado) AS cliente,
        CONCAT(do.calle, ' ', do.numero, ' ', do.colonia, ' ', do.codigoPostal, ' ', do.ciudad, ' ', do.estado) AS origen,
        CONCAT(dd.calle, ' ', dd.numero, ' ', dd.colonia, ' ', dd.codigoPostal, ' ', dd.ciudad, ' ', dd.estado) AS destino
    FROM Envio e
    INNER JOIN Cliente c ON c.idCliente = e.idCliente
    INNER JOIN DireccionCliente dc ON dc.idDireccion = c.idDireccion
    INNER JOIN DireccionOrigen do ON do.idOrigen = e.idOrigen
    INNER JOIN DireccionDestino dd ON dd.idDestino = e.idDestino
    WHERE e.numeroGuia = #{numeroGuia};
   </select>

   <select id="obtenerEnvioNoLicencia" resultType="pojo.Envio">
    SELECT e.numeroGuia, s.status,
           CONCAT(c2.nombre, ' ', c2.apellidoMaterno, ' ', c2.apellidoPaterno) AS `repartidor`,
       ONCAT(do.calle, ' ', do.numero, ' ', do.colonia, ' ', do.codigoPostal, ' ', do.ciudad, ' ', do.estado) AS `origen`,
           CONCAT(d2.calle, ' ', d2.numero, ' ', d2.colonia, ' ', d2.codigoPostal, ' ', d2.estado, ' ', d2.ciudad) AS `destino`
    FROM envio e
    INNER JOIN direcciondestino d2 ON d2.idDestino = e.idDestino
    INNER JOIN DireccionOrigen do ON do.idOrigen = e.idOrigen
    INNER JOIN asociacionenvio a ON a.idEnvio = e.idEnvio
    INNER JOIN statusenvio s ON s.idEnvio = e.idEnvio
    INNER JOIN conductor c ON c.idConductor = a.idConductor
    INNER JOIN colaborador c2 ON c2.idColaborador = c.idConductor
    WHERE c.numeroLicencia = #{numeroLicencia};
</select> 
    <select id="obtenerEstatus" resultType="pojo.Envio">
    SELECT se.idStatus, se.idEnvio, se.status,se.motivo,
    FROM StatusEnvio se
    WHERE se.idEnvio = #{idEnvio};
    </select>

    <insert id="cambiarStatus" parameterType="map"> 
      INSERT INTO statusenvio (idEnvio, status,motivo)
      VALUES (#{idEnvio},#{status},#{motivo});
   </insert>
        
    <insert id="registrarEnvio" parameterType="pojo.Envio" >
     INSERT INTO Envio (costo, idOrigen, idDestino, idPaquete, idCliente, status)
     VALUES (#{costo}, #{idOrigen}, #{idDestino}, #{idPaquete}, #{idCliente}, #{status});
    </insert>

    <update id="editarEnvio" parameterType="pojo.Envio">
    UPDATE Envio
    SET  costo = #{costo}, idOrigen = #{idOrigen}, idDestino = #{idDestino},idPaquete = #{idPaquete},idCliente = #{idCliente},status = #{status}
    WHERE idEnvio = #{idEnvio};
    </update>
    
    <delete id="eliminarEnvioId" parameterType="pojo.Envio">
        DELETE
        FROM Envio
        WHERE idEnvio = #{idEnvio}
    </delete>

</mapper>